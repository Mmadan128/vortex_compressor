<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: transformer_block Pages: 1 -->
<svg width="761pt" height="1021pt"
 viewBox="0.00 0.00 760.50 1021.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1017)">
<title>transformer_block</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1017 756.5,-1017 756.5,4 -4,4"/>
<text text-anchor="middle" x="376.25" y="-996.2" font-family="Arial" font-size="16.00">Single Compressive Transformer Block (1.84M params)</text>
<g id="clust1" class="cluster">
<title>cluster_attention</title>
<polygon fill="#ffeebb" stroke="black" points="297,-511 297,-979 593,-979 593,-511 297,-511"/>
<text text-anchor="middle" x="445" y="-962.2" font-family="Arial" font-size="16.00">Compressive Multi&#45;Head Attention</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_ffn</title>
<polygon fill="#ccddff" stroke="black" points="8,-142 8,-342 188,-342 188,-142 8,-142"/>
<text text-anchor="middle" x="98" y="-325.2" font-family="Arial" font-size="16.00">Feed&#45;Forward Network</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<path fill="#e1f5ff" stroke="black" d="M219.5,-937.5C219.5,-937.5 126.5,-937.5 126.5,-937.5 120.5,-937.5 114.5,-931.5 114.5,-925.5 114.5,-925.5 114.5,-911.5 114.5,-911.5 114.5,-905.5 120.5,-899.5 126.5,-899.5 126.5,-899.5 219.5,-899.5 219.5,-899.5 225.5,-899.5 231.5,-905.5 231.5,-911.5 231.5,-911.5 231.5,-925.5 231.5,-925.5 231.5,-931.5 225.5,-937.5 219.5,-937.5"/>
<text text-anchor="middle" x="173" y="-922.3" font-family="Arial" font-size="14.00">Input</text>
<text text-anchor="middle" x="173" y="-907.3" font-family="Arial" font-size="14.00">[batch, 512, 512]</text>
</g>
<!-- ln1 -->
<g id="node2" class="node">
<title>ln1</title>
<path fill="#ffe1cc" stroke="black" d="M277,-833.5C277,-833.5 201,-833.5 201,-833.5 195,-833.5 189,-827.5 189,-821.5 189,-821.5 189,-807.5 189,-807.5 189,-801.5 195,-795.5 201,-795.5 201,-795.5 277,-795.5 277,-795.5 283,-795.5 289,-801.5 289,-807.5 289,-807.5 289,-821.5 289,-821.5 289,-827.5 283,-833.5 277,-833.5"/>
<text text-anchor="middle" x="239" y="-818.3" font-family="Arial" font-size="14.00">Layer Norm 1</text>
<text text-anchor="middle" x="239" y="-803.3" font-family="Arial" font-size="14.00">1,024 params</text>
</g>
<!-- input&#45;&gt;ln1 -->
<g id="edge7" class="edge">
<title>input&#45;&gt;ln1</title>
<path fill="none" stroke="black" d="M184.8,-899.26C195.03,-883.45 209.97,-860.36 221.58,-842.42"/>
<polygon fill="black" stroke="black" points="224.81,-843.87 227.3,-833.58 218.93,-840.07 224.81,-843.87"/>
</g>
<!-- residual1 -->
<g id="node9" class="node">
<title>residual1</title>
<path fill="#d0ffd0" stroke="black" d="M231.5,-482C231.5,-482 114.5,-482 114.5,-482 108.5,-482 102.5,-476 102.5,-470 102.5,-470 102.5,-456 102.5,-456 102.5,-450 108.5,-444 114.5,-444 114.5,-444 231.5,-444 231.5,-444 237.5,-444 243.5,-450 243.5,-456 243.5,-456 243.5,-470 243.5,-470 243.5,-476 237.5,-482 231.5,-482"/>
<text text-anchor="middle" x="173" y="-466.8" font-family="Arial" font-size="14.00">Residual Connection</text>
<text text-anchor="middle" x="173" y="-451.8" font-family="Arial" font-size="14.00">+ Dropout</text>
</g>
<!-- input&#45;&gt;residual1 -->
<g id="edge10" class="edge">
<title>input&#45;&gt;residual1</title>
<path fill="none" stroke="blue" stroke-dasharray="5,2" d="M169.53,-899.15C165.99,-878.79 161,-844.92 161,-815.5 161,-815.5 161,-815.5 161,-537 161,-522.1 163.46,-505.72 166.16,-492.25"/>
<polygon fill="blue" stroke="blue" points="169.65,-492.68 168.33,-482.16 162.8,-491.21 169.65,-492.68"/>
<text text-anchor="middle" x="194.5" y="-668.8" font-family="Times,serif" font-size="14.00"> &#160;residual</text>
</g>
<!-- qkv -->
<g id="node6" class="node">
<title>qkv</title>
<path fill="#ffd0cc" stroke="black" d="M425.5,-751C425.5,-751 318.5,-751 318.5,-751 312.5,-751 306.5,-745 306.5,-739 306.5,-739 306.5,-710 306.5,-710 306.5,-704 312.5,-698 318.5,-698 318.5,-698 425.5,-698 425.5,-698 431.5,-698 437.5,-704 437.5,-710 437.5,-710 437.5,-739 437.5,-739 437.5,-745 431.5,-751 425.5,-751"/>
<text text-anchor="middle" x="372" y="-735.8" font-family="Arial" font-size="14.00">Q, K, V Projections</text>
<text text-anchor="middle" x="372" y="-720.8" font-family="Arial" font-size="14.00">8 heads, d_k=64</text>
<text text-anchor="middle" x="372" y="-705.8" font-family="Arial" font-size="14.00">786,432 params</text>
</g>
<!-- ln1&#45;&gt;qkv -->
<g id="edge8" class="edge">
<title>ln1&#45;&gt;qkv</title>
<path fill="none" stroke="black" d="M266.24,-795.48C283.12,-784.31 305.26,-769.66 324.92,-756.65"/>
<polygon fill="black" stroke="black" points="327.05,-759.44 333.46,-751 323.19,-753.6 327.05,-759.44"/>
</g>
<!-- mem_comp -->
<g id="node3" class="node">
<title>mem_comp</title>
<path fill="#ffe1e1" stroke="black" d="M441,-945C441,-945 317,-945 317,-945 311,-945 305,-939 305,-933 305,-933 305,-904 305,-904 305,-898 311,-892 317,-892 317,-892 441,-892 441,-892 447,-892 453,-898 453,-904 453,-904 453,-933 453,-933 453,-939 447,-945 441,-945"/>
<text text-anchor="middle" x="379" y="-929.8" font-family="Arial" font-size="14.00">Compressed Memory</text>
<text text-anchor="middle" x="379" y="-914.8" font-family="Arial" font-size="14.00">Old activations</text>
<text text-anchor="middle" x="379" y="-899.8" font-family="Arial" font-size="14.00">4:1 compressed</text>
</g>
<!-- concat -->
<g id="node5" class="node">
<title>concat</title>
<path fill="#ffffcc" stroke="black" d="M413.5,-833.5C413.5,-833.5 344.5,-833.5 344.5,-833.5 338.5,-833.5 332.5,-827.5 332.5,-821.5 332.5,-821.5 332.5,-807.5 332.5,-807.5 332.5,-801.5 338.5,-795.5 344.5,-795.5 344.5,-795.5 413.5,-795.5 413.5,-795.5 419.5,-795.5 425.5,-801.5 425.5,-807.5 425.5,-807.5 425.5,-821.5 425.5,-821.5 425.5,-827.5 419.5,-833.5 413.5,-833.5"/>
<text text-anchor="middle" x="379" y="-818.3" font-family="Arial" font-size="14.00">Concatenate</text>
<text text-anchor="middle" x="379" y="-803.3" font-family="Arial" font-size="14.00">Memories</text>
</g>
<!-- mem_comp&#45;&gt;concat -->
<g id="edge1" class="edge">
<title>mem_comp&#45;&gt;concat</title>
<path fill="none" stroke="black" d="M379,-891.76C379,-877.13 379,-858.8 379,-843.77"/>
<polygon fill="black" stroke="black" points="382.5,-843.52 379,-833.52 375.5,-843.52 382.5,-843.52"/>
</g>
<!-- mem_recent -->
<g id="node4" class="node">
<title>mem_recent</title>
<path fill="#e1ffe1" stroke="black" d="M572.5,-945C572.5,-945 483.5,-945 483.5,-945 477.5,-945 471.5,-939 471.5,-933 471.5,-933 471.5,-904 471.5,-904 471.5,-898 477.5,-892 483.5,-892 483.5,-892 572.5,-892 572.5,-892 578.5,-892 584.5,-898 584.5,-904 584.5,-904 584.5,-933 584.5,-933 584.5,-939 578.5,-945 572.5,-945"/>
<text text-anchor="middle" x="528" y="-929.8" font-family="Arial" font-size="14.00">Recent Memory</text>
<text text-anchor="middle" x="528" y="-914.8" font-family="Arial" font-size="14.00">Last 512 tokens</text>
<text text-anchor="middle" x="528" y="-899.8" font-family="Arial" font-size="14.00">Full resolution</text>
</g>
<!-- mem_recent&#45;&gt;concat -->
<g id="edge2" class="edge">
<title>mem_recent&#45;&gt;concat</title>
<path fill="none" stroke="black" d="M490.07,-891.77C481.49,-885.94 472.43,-879.76 464,-874 447.56,-862.76 429.37,-850.24 414.05,-839.69"/>
<polygon fill="black" stroke="black" points="415.61,-836.52 405.39,-833.72 411.64,-842.28 415.61,-836.52"/>
</g>
<!-- compress_layer -->
<g id="node15" class="node">
<title>compress_layer</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="752.5,-841 601.5,-841 601.5,-788 752.5,-788 752.5,-841"/>
<text text-anchor="middle" x="677" y="-825.8" font-family="Arial" font-size="14.00">Memory Compression</text>
<text text-anchor="middle" x="677" y="-810.8" font-family="Arial" font-size="14.00">Conv1D (stride=4)</text>
<text text-anchor="middle" x="677" y="-795.8" font-family="Arial" font-size="14.00">1,049,088 params</text>
</g>
<!-- mem_recent&#45;&gt;compress_layer -->
<g id="edge16" class="edge">
<title>mem_recent&#45;&gt;compress_layer</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M565.6,-891.76C585.53,-878.12 610.17,-861.25 631.2,-846.85"/>
<polygon fill="black" stroke="black" points="633.4,-849.59 639.67,-841.05 629.44,-843.81 633.4,-849.59"/>
<text text-anchor="middle" x="644.5" y="-862.8" font-family="Times,serif" font-size="14.00">when full</text>
</g>
<!-- concat&#45;&gt;qkv -->
<g id="edge3" class="edge">
<title>concat&#45;&gt;qkv</title>
<path fill="none" stroke="black" d="M377.55,-795.27C376.76,-785.38 375.76,-772.8 374.83,-761.07"/>
<polygon fill="black" stroke="black" points="378.31,-760.74 374.03,-751.05 371.34,-761.3 378.31,-760.74"/>
</g>
<!-- attn -->
<g id="node7" class="node">
<title>attn</title>
<path fill="#ffccaa" stroke="black" d="M427,-647C427,-647 317,-647 317,-647 311,-647 305,-641 305,-635 305,-635 305,-606 305,-606 305,-600 311,-594 317,-594 317,-594 427,-594 427,-594 433,-594 439,-600 439,-606 439,-606 439,-635 439,-635 439,-641 433,-647 427,-647"/>
<text text-anchor="middle" x="372" y="-631.8" font-family="Arial" font-size="14.00">Scaled Dot&#45;Product</text>
<text text-anchor="middle" x="372" y="-616.8" font-family="Arial" font-size="14.00">Attention</text>
<text text-anchor="middle" x="372" y="-601.8" font-family="Arial" font-size="14.00">+ Causal Mask</text>
</g>
<!-- qkv&#45;&gt;attn -->
<g id="edge4" class="edge">
<title>qkv&#45;&gt;attn</title>
<path fill="none" stroke="black" d="M372,-697.76C372,-685.56 372,-670.78 372,-657.49"/>
<polygon fill="black" stroke="black" points="375.5,-657.23 372,-647.23 368.5,-657.23 375.5,-657.23"/>
</g>
<!-- out_proj -->
<g id="node8" class="node">
<title>out_proj</title>
<path fill="#ffd0cc" stroke="black" d="M418,-557C418,-557 320,-557 320,-557 314,-557 308,-551 308,-545 308,-545 308,-531 308,-531 308,-525 314,-519 320,-519 320,-519 418,-519 418,-519 424,-519 430,-525 430,-531 430,-531 430,-545 430,-545 430,-551 424,-557 418,-557"/>
<text text-anchor="middle" x="369" y="-541.8" font-family="Arial" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="369" y="-526.8" font-family="Arial" font-size="14.00">262,144 params</text>
</g>
<!-- attn&#45;&gt;out_proj -->
<g id="edge5" class="edge">
<title>attn&#45;&gt;out_proj</title>
<path fill="none" stroke="black" d="M371.03,-593.59C370.73,-585.31 370.38,-576.11 370.07,-567.65"/>
<polygon fill="black" stroke="black" points="373.56,-567.33 369.69,-557.47 366.56,-567.59 373.56,-567.33"/>
</g>
<!-- out_proj&#45;&gt;residual1 -->
<g id="edge9" class="edge">
<title>out_proj&#45;&gt;residual1</title>
<path fill="none" stroke="black" d="M320.55,-518.96C293.46,-508.86 259.51,-496.22 231.01,-485.61"/>
<polygon fill="black" stroke="black" points="232.16,-482.3 221.57,-482.09 229.72,-488.86 232.16,-482.3"/>
</g>
<!-- ln2 -->
<g id="node10" class="node">
<title>ln2</title>
<path fill="#ffe1cc" stroke="black" d="M170,-407C170,-407 94,-407 94,-407 88,-407 82,-401 82,-395 82,-395 82,-381 82,-381 82,-375 88,-369 94,-369 94,-369 170,-369 170,-369 176,-369 182,-375 182,-381 182,-381 182,-395 182,-395 182,-401 176,-407 170,-407"/>
<text text-anchor="middle" x="132" y="-391.8" font-family="Arial" font-size="14.00">Layer Norm 2</text>
<text text-anchor="middle" x="132" y="-376.8" font-family="Arial" font-size="14.00">1,024 params</text>
</g>
<!-- residual1&#45;&gt;ln2 -->
<g id="edge11" class="edge">
<title>residual1&#45;&gt;ln2</title>
<path fill="none" stroke="black" d="M162.87,-443.96C158.13,-435.53 152.4,-425.33 147.17,-416.01"/>
<polygon fill="black" stroke="black" points="150.11,-414.1 142.16,-407.09 144.01,-417.52 150.11,-414.1"/>
</g>
<!-- residual2 -->
<g id="node13" class="node">
<title>residual2</title>
<path fill="#d0ffd0" stroke="black" d="M224.5,-113C224.5,-113 107.5,-113 107.5,-113 101.5,-113 95.5,-107 95.5,-101 95.5,-101 95.5,-87 95.5,-87 95.5,-81 101.5,-75 107.5,-75 107.5,-75 224.5,-75 224.5,-75 230.5,-75 236.5,-81 236.5,-87 236.5,-87 236.5,-101 236.5,-101 236.5,-107 230.5,-113 224.5,-113"/>
<text text-anchor="middle" x="166" y="-97.8" font-family="Arial" font-size="14.00">Residual Connection</text>
<text text-anchor="middle" x="166" y="-82.8" font-family="Arial" font-size="14.00">+ Dropout</text>
</g>
<!-- residual1&#45;&gt;residual2 -->
<g id="edge14" class="edge">
<title>residual1&#45;&gt;residual2</title>
<path fill="none" stroke="blue" stroke-dasharray="5,2" d="M190.57,-443.82C202.08,-429.95 215,-409.76 215,-389 215,-389 215,-389 215,-175.5 215,-155.21 203.5,-135.68 191.64,-120.94"/>
<polygon fill="blue" stroke="blue" points="194.24,-118.6 185.08,-113.27 188.92,-123.15 194.24,-118.6"/>
<text text-anchor="middle" x="248.5" y="-270.3" font-family="Times,serif" font-size="14.00"> &#160;residual</text>
</g>
<!-- linear1 -->
<g id="node11" class="node">
<title>linear1</title>
<path fill="#ccccff" stroke="black" d="M167,-308C167,-308 65,-308 65,-308 59,-308 53,-302 53,-296 53,-296 53,-252 53,-252 53,-246 59,-240 65,-240 65,-240 167,-240 167,-240 173,-240 179,-246 179,-252 179,-252 179,-296 179,-296 179,-302 173,-308 167,-308"/>
<text text-anchor="middle" x="116" y="-292.8" font-family="Arial" font-size="14.00">Linear 512→2048</text>
<text text-anchor="middle" x="116" y="-277.8" font-family="Arial" font-size="14.00">+ GELU</text>
<text text-anchor="middle" x="116" y="-262.8" font-family="Arial" font-size="14.00">+ Dropout</text>
<text text-anchor="middle" x="116" y="-247.8" font-family="Arial" font-size="14.00">1,048,576 params</text>
</g>
<!-- ln2&#45;&gt;linear1 -->
<g id="edge12" class="edge">
<title>ln2&#45;&gt;linear1</title>
<path fill="none" stroke="black" d="M129.36,-368.51C127.4,-354.79 124.65,-335.53 122.15,-318.05"/>
<polygon fill="black" stroke="black" points="125.6,-317.42 120.72,-308.02 118.67,-318.41 125.6,-317.42"/>
</g>
<!-- linear2 -->
<g id="node12" class="node">
<title>linear2</title>
<path fill="#ccccff" stroke="black" d="M168,-203C168,-203 66,-203 66,-203 60,-203 54,-197 54,-191 54,-191 54,-162 54,-162 54,-156 60,-150 66,-150 66,-150 168,-150 168,-150 174,-150 180,-156 180,-162 180,-162 180,-191 180,-191 180,-197 174,-203 168,-203"/>
<text text-anchor="middle" x="117" y="-187.8" font-family="Arial" font-size="14.00">Linear 2048→512</text>
<text text-anchor="middle" x="117" y="-172.8" font-family="Arial" font-size="14.00">+ Dropout</text>
<text text-anchor="middle" x="117" y="-157.8" font-family="Arial" font-size="14.00">1,048,576 params</text>
</g>
<!-- linear1&#45;&gt;linear2 -->
<g id="edge6" class="edge">
<title>linear1&#45;&gt;linear2</title>
<path fill="none" stroke="black" d="M116.35,-239.87C116.44,-231.29 116.53,-222.01 116.63,-213.3"/>
<polygon fill="black" stroke="black" points="120.13,-213.08 116.73,-203.05 113.13,-213.01 120.13,-213.08"/>
</g>
<!-- linear2&#45;&gt;residual2 -->
<g id="edge13" class="edge">
<title>linear2&#45;&gt;residual2</title>
<path fill="none" stroke="black" d="M132.77,-149.59C138.09,-140.85 144.04,-131.08 149.41,-122.25"/>
<polygon fill="black" stroke="black" points="152.55,-123.83 154.76,-113.47 146.57,-120.19 152.55,-123.83"/>
</g>
<!-- output -->
<g id="node14" class="node">
<title>output</title>
<path fill="#e1ffe1" stroke="black" d="M212.5,-38C212.5,-38 119.5,-38 119.5,-38 113.5,-38 107.5,-32 107.5,-26 107.5,-26 107.5,-12 107.5,-12 107.5,-6 113.5,0 119.5,0 119.5,0 212.5,0 212.5,0 218.5,0 224.5,-6 224.5,-12 224.5,-12 224.5,-26 224.5,-26 224.5,-32 218.5,-38 212.5,-38"/>
<text text-anchor="middle" x="166" y="-22.8" font-family="Arial" font-size="14.00">Output</text>
<text text-anchor="middle" x="166" y="-7.8" font-family="Arial" font-size="14.00">[batch, 512, 512]</text>
</g>
<!-- residual2&#45;&gt;output -->
<g id="edge15" class="edge">
<title>residual2&#45;&gt;output</title>
<path fill="none" stroke="black" d="M166,-74.96C166,-66.88 166,-57.18 166,-48.18"/>
<polygon fill="black" stroke="black" points="169.5,-48.09 166,-38.09 162.5,-48.09 169.5,-48.09"/>
</g>
<!-- compress_layer&#45;&gt;mem_comp -->
<g id="edge17" class="edge">
<title>compress_layer&#45;&gt;mem_comp</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M601.27,-839.89C599.84,-840.27 598.41,-840.64 597,-841 555.77,-851.48 543.44,-845.82 503,-859 480.03,-866.48 455.79,-877.23 434.89,-887.47"/>
<polygon fill="black" stroke="black" points="433.24,-884.38 425.85,-891.97 436.36,-890.65 433.24,-884.38"/>
<text text-anchor="middle" x="546" y="-862.8" font-family="Times,serif" font-size="14.00">compressed</text>
</g>
</g>
</svg>
